@page "/contribution/{contributionId}/adddisc"

@rendermode @(new InteractiveAutoRenderMode(prerender:true))

@if (contribution is not null)
{
    <TheDiscDb.Client.Controls.Breadcrumb PrimaryText="Add Disc" Items="[
        GetRootContributionLink(),
        GetContributionLink(contribution)
    ]" />

    <div class="contribute-layout add-disc-page">
        <section class="contribute-hero compact">
            <p class="eyebrow">Add a Disc</p>
            <h1>@contribution.Title (@contribution.Year)</h1>
            <p>Ensure the disc you would like to add is in your optical drive.</p>
        </section>

        @if (handler is null)
        {
            <section class="info-card">
                <p>
                    Insert the disc you want to add, then select its root folder (usually the drive letter). We’ll hash it to see if it already exists
                    in the database. Your browser may request file-system access.
                </p>
                <button class="btn btn-primary" @onclick="OpenFolderAsync">Select Disc Root Folder</button>
            </section>
        }
        else
        {
            <section class="info-card add-disc-form-card">
                <EditForm Model="@request" OnValidSubmit="HandleValidSubmit">
                    <DataAnnotationsValidator />
                    <ValidationSummary />

                    <div class="form-grid">
                        <div class="mb-3">
                            <label>Disc Format</label>
                            <SfDropDownList TValue="string" TItem="string" DataSource="formats" class="form-control" @bind-Value="request.Format" Placeholder="Select format" />
                            <ValidationMessage For="@(() => request.Format)" />
                        </div>

                        <div class="mb-3">
                            <label>Disc Title</label>
                            <InputText class="form-control" @bind-Value="request.Name" @oninput="DiscTitleChanged" />
                            <ValidationMessage For="@(() => request.Name)" />
                        </div>

                        <div class="mb-3">
                            <label>Disc Slug</label>
                            <InputText class="form-control" @bind-Value="request.Slug" />
                            <ValidationMessage For="@(() => request.Slug)" />
                        </div>
                    </div>

                    <div class="cta-row split">
                        <a class="btn btn-secondary" href="/contribution/@ContributionId">Cancel</a>
                        <button type="submit" class="btn btn-primary">Save Disc</button>
                    </div>
                </EditForm>
            </section>
        }
    </div>
}
else
{
    <div class="contribute-layout">
        <section class="contribute-hero compact">
            <h1>Loading...</h1>
        </section>
    </div>
}

<Syncfusion.Blazor.Popups.SfDialogProvider />
