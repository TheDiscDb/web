@page "/contribute/{mediaType}/{externalId}"

@rendermode @(new InteractiveAutoRenderMode(prerender:false))

@if (this.externalData != null)
{
    <TheDiscDb.Client.Controls.Breadcrumb PrimaryText="@BreadcrumbText" Items="[
        GetRootContributionLink()
    ]" />
}

<div class="contribute-layout identify-title-page">
    <section class="contribute-hero compact">
        <p class="eyebrow">Step 2 · Add Release Details</p>
        <h1>Release Details</h1>
        <p>We recommend getting most of these details from the Amazon product page for this release if you can.</p>
    </section>

<EditForm Model="@request" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label>ASIN<span class="required">*</span></label>
        <InputText class="form-control" @bind-Value="request.Asin" />
        <ValidationMessage For="@(() => request.Asin)" />
        @* <button type="button" class="btn btn-secondary" disabled="@ImportFromAmazonDisabled" @onclick="ImportFromAmazon">Import</button> *@
    </div>
    <div class="mb-3">
        <label>UPC/EAN<span class="required">*</span></label>
        <InputText class="form-control" @bind-Value="request.Upc" />
        <ValidationMessage For="@(() => request.Upc)" />
    </div>
    <div class="mb-3">
        <label>Release Date<span class="required">*</span></label>
        <InputText class="form-control" @bind-Value="releaseDate" @oninput="ReleaseDateChanged" />
        @* <SfDatePicker TValue="DateTimeOffset" class="form-control" Placeholder='Choose a Release Date or paste from Amazon' @bind-Value="request.ReleaseDate" OnInput="ReleaseDateChanged"></SfDatePicker> *@
        <div class="validation-message">@releaseDateValidationMessage</div>
    </div>
    <div class="mb-3">
        <label>Front Image<span class="required">*</span></label>
        <div class="hstack gap-3 align-items-start">
            <SfUploader @ref="frontImageUploader" AutoUpload="true" ShowFileList="true" AllowMultiple="false" AllowedExtensions=".jpg, .jpeg">
                <UploaderButtons Browse="Browse"></UploaderButtons>
                <UploaderEvents FileSelected="FrontImageSelected" BeforeRemove="BeforeFrontImageRemove" OnRemove="FrontImageRemoved"></UploaderEvents>
                <UploaderAsyncSettings SaveUrl="@frontImageUploadUrl" RemoveUrl="@frontImageRemoveUrl"></UploaderAsyncSettings>
            </SfUploader>
            <span id="frontImagePreview">
                <img src="@frontImagePreviewUrl" />
            </span>
        </div>
        <ValidationMessage For="@(() => request.FrontImageUrl)" />
    </div>
    <div class="mb-3">
        <label>Back Image</label>
        <div class="hstack gap-3 align-items-start">
        <SfUploader @ref="backImageUploader" AutoUpload="true" ShowFileList="true" AllowMultiple="false" AllowedExtensions=".jpg, .jpeg">
            <UploaderButtons Browse="Browse"></UploaderButtons>
                <UploaderEvents FileSelected="BackImageSelected" BeforeRemove="BeforeBackImageRemove" OnRemove="BackImageRemoved"></UploaderEvents>
            <UploaderAsyncSettings SaveUrl="@backImageUploadUrl" RemoveUrl="@backImageRemoveUrl"></UploaderAsyncSettings>
        </SfUploader>
            <span id="backImagePreview">
                <img src="@backImagePreviewUrl" />
            </span>
        </div>
        <ValidationMessage For="@(() => request.BackImageUrl)" />
    </div>
    <div class="mb-3">
        <label>Release Title<span class="required">*</span></label>
        <InputText class="form-control" @bind-Value="request.ReleaseTitle" @oninput="ReleaseTitleChanged" />
        <ValidationMessage For="@(() => request.ReleaseTitle)" />
    </div>
    <div class="mb-3">
        <label>Release Slug<span class="required">*</span></label>
        <InputText class="form-control" @bind-Value="request.ReleaseSlug" />
        <ValidationMessage For="@(() => request.ReleaseSlug)" />
    </div>
    <div class="mb-3">
        <label>Locale</label>
        <InputText class="form-control" @bind-Value="request.Locale" />
        <ValidationMessage For="@(() => request.Locale)" />
    </div>
    <div class="mb-3">
        <label>Region Code</label>
        <InputText class="form-control" @bind-Value="request.RegionCode" />
        <ValidationMessage For="@(() => request.RegionCode)" />
    </div>
    <div class="cta-row split">
        <a class="btn btn-secondary" href="/contribute/@this.MediaType">Back</a>
        <button type="submit" class="btn btn-primary">Save Release Details</button>
    </div>
</EditForm>

<div id="container">
    <SfSpinner @bind-Visible="@IsAmazonImportInProgress" Label="Importing from Amazon...">
    </SfSpinner>
</div>

<div class="col-lg-12 control-section toast-default-section">
    <SfToast ID="toast_default" @ref="toast" Title="User Message" Content="@toastContent" Timeout="5000" Icon="e-meeting">
        <ToastPosition X="Right"></ToastPosition>
    </SfToast>
</div>
</div>