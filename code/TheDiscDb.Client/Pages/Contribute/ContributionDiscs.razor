@page "/contribution/{contributionId}"
@rendermode @(new InteractiveAutoRenderMode(prerender:false))

@if (Contribution is not null)
{
    <TheDiscDb.Client.Controls.Breadcrumb PrimaryText="@GetContributionLinkText(Contribution)" Items="[GetRootContributionLink()]" />

    <div class="contribute-layout contribution-discs-page">
        <section class="contribute-hero compact">
            <h1>@Contribution.Title (@Contribution.Year)</h1>
            <p>Review the release summary, manage discs, and complete the submission when everything looks good.</p>
        </section>

        <section class="info-grid single-column">
            <article class="info-card release-summary-card">
                <div class="release-summary">
                    <div class="cover-stack">
                        @if (!string.IsNullOrEmpty(Contribution.FrontImageUrl))
                        {
                            <img src="@Contribution.FrontImageUrl?width=180&height=260" alt="Front cover" class="cover" />
                        }
                        @if (!string.IsNullOrEmpty(Contribution.BackImageUrl))
                        {
                            <img src="@Contribution.BackImageUrl?width=120&height=170" alt="Back cover" class="cover secondary" />
                        }
                    </div>
                    <dl>
                        <dt>Release title</dt>
                        <dd>@Contribution.ReleaseTitle</dd>

                        <dt>Release date</dt>
                        <dd>@string.Format("{0:yyyy-MM-dd}", Contribution.ReleaseDate)</dd>

                        <dt>Locale / Region</dt>
                        <dd>@Contribution.Locale · @(string.IsNullOrEmpty(Contribution.RegionCode) ? "N/A" : Contribution.RegionCode)</dd>

                        @if (!string.IsNullOrEmpty(Contribution.Asin))
                        {
                            <dt>ASIN</dt>
                            <dd>@Contribution.Asin</dd>
                        }

                        @if (!string.IsNullOrEmpty(Contribution.Upc))
                        {
                            <dt>UPC</dt>
                            <dd>@Contribution.Upc</dd>
                        }

                        @if (!string.IsNullOrEmpty(Contribution.ExternalProvider))
                        {
                            <dt>External provider</dt>
                            <dd>@Contribution.ExternalProvider (@Contribution.ExternalId)</dd>
                        }

                        <dt>Status</dt>
                        <dd><span class="badge bg-@GetStatusBadgeClass()">@Contribution.Status</span></dd>
                    </dl>
                </div>
            </article>
        </section>

        <section class="info-card discs-card">
            <div class="section-header">
                <h2>Discs in this release</h2>
                <a class="btn btn-accent btn-large" href="/contribution/@ContributionId/AddDisc">
                    <span class="btn-icon">+</span>
                    Add Disc
                </a>
            </div>

            <QuickGrid Items="Discs" class="striped-grid contribute-grid" ItemKey="d => d.EncodedId">
                <TemplateColumn Title="Name">
                    <div class="disc-name">
                        <a href="/contribution/@ContributionId/discs/@context!.EncodedId/identify" title="Edit Disc">@context.Name</a>
                    </div>
                </TemplateColumn>
                <PropertyColumn Property="d => d!.Format"></PropertyColumn>
                <TemplateColumn Title="Logs">
                    @if (!string.IsNullOrEmpty(context!.ExistingDiscPath))
                    {
                        <span class="badge bg-light text-dark">Copied from another disc</span>
                    }
                    else
                    {
                        <span>@(context.LogsUploaded ? "Uploaded" : "Pending")</span>
                    }
                </TemplateColumn>
            </QuickGrid>
        </section>

        <div class="cta-row split">
            <a class="btn btn-secondary" href="/contribute/@Contribution.MediaType!.ToLowerInvariant()">Back to release details</a>
            <button class="btn btn-primary" @onclick="NavigateToReview" disabled="@IsCompleteButtonDisabled">Complete Contribution</button>
        </div>
    </div>
}
else
{
    <div class="contribute-layout">
        <section class="contribute-hero compact">
            <h1>Loading Contribution...</h1>
        </section>
    </div>
}